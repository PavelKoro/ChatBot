<!DOCTYPE html>
<!-- saved from url=(0012)about:srcdoc -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка и удаление файлов</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }

        /* Стиль для зоны перетаскивания */
        #dropZone {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            color: #999;
        }

        #dropZone.dragover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>

<h1>Загрузка и удаление файлов</h1>

<!-- Зона перетаскивания -->
<div id="dropZone">Перетащите сюда файл .txt</div>

<!-- Загрузка файла -->
<input type="file" id="fileInput" accept=".txt">
<button onclick="uploadFile()">Загрузить файл</button>

<h2>Список файлов:</h2>
<table id="fileTable">
    <tbody><tr>
        <th>Выбрать</th>
        <th>Имя файла</th>
    </tr>
</tbody></table>
<button onclick="deleteFiles()">Удалить выбранные файлы</button>

<script>
    const fileTable = document.getElementById('fileTable');
    const dropZone = document.getElementById('dropZone');
    const loadedFiles = new Map(); // Хранит содержимое файлов для проверки уникальности

    // Обработка загрузки файла
    function uploadFile(event) {
        const input = document.getElementById('fileInput');
        const files = event?.dataTransfer?.files || input.files;

        for (let i = 0; i < files.length; i++) {
            const file = files[i];

            // Проверка типа файла
            if (file.type !== "text/plain") {
                alert(`Файл "${file.name}" не является .txt.`);
                continue;
            }

            // Проверка уникальности имени файла
            if (loadedFiles.has(file.name)) {
                alert(`Файл с именем "${file.name}" уже существует.`);
                continue;
            }

            // Чтение файла для проверки содержания
            const reader = new FileReader();
            reader.onload = function () {
                const content = reader.result;
                let isUnique = true;

                // Проверка на уникальность содержания (95%)
                for (const [name, existingContent] of loadedFiles) {
                    const similarity = calculateSimilarity(content, existingContent);
                    if (similarity > 0.95) {
                        alert(`Содержание файла "${file.name}" похоже на "${name}" на ${Math.round(similarity * 100)}%.`);
                        isUnique = false;
                        break;
                    }
                }

                if (isUnique) {
                    // Добавляем файл в таблицу и список
                    addFileToTable(file.name);
                    loadedFiles.set(file.name, content);
                }
            };
            reader.readAsText(file);
        }

        if (input) {
            input.value = ''; // Сбрасываем input
        }
    }

    // Добавить файл в таблицу
    function addFileToTable(fileName) {
        const row = fileTable.insertRow();
        const cell1 = row.insertCell(0);
        const cell2 = row.insertCell(1);
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        cell1.appendChild(checkbox);
        cell2.textContent = fileName;
    }

    // Удаление файлов
    function deleteFiles() {
        const rows = fileTable.rows;
        const rowsToDelete = [];


        for (let i = 1; i < rows.length; i++) { // Начинаем с 1, чтобы пропустить заголовок
            const checkbox = rows[i].cells[0].firstChild;
            if (checkbox && checkbox.checked) {
                const fileName = rows[i].cells[1].textContent;
                loadedFiles.delete(fileName); // Удаляем из списка файлов
                rowsToDelete.push(i);
            }
        }

        // Удаляем файлы из таблицы
        for (let i = rowsToDelete.length - 1; i >= 0; i--) {
            fileTable.deleteRow(rowsToDelete[i]);
        }
    }

    // Вычисление схожести содержания двух текстов
    function calculateSimilarity(content1, content2) {
        const words1 = content1.split(/\s+/);
        const words2 = content2.split(/\s+/);
        const commonWords = words1.filter(word => words2.includes(word));
        return commonWords.length / Math.max(words1.length, words2.length);
    }

    // Обработка событий перетаскивания
    dropZone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (event) => {
        event.preventDefault();
        dropZone.classList.remove('dragover');
        uploadFile(event);
    });
</script>




<style>
</style>
<script>
// your code goes here
</script></body></html>